<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/findpassword.css}">
    <!-- jQuery 추가 -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

	<header>
    <h2>이메일 주소를 입력하세요</h2>
    </header>
    <!-- 에러 메시지가 있을 경우 표시 -->
    <p th:if="${error}" style="color: red" th:text="${error}"></p>

   <!-- 메인 페이지로 이동하는 링크 -->
<a id="mainPageLink" href="/" onclick="return true;">메인 페이지로 이동</a>

    <!-- 이메일 입력 폼 -->
    <form method="post" th:action="@{/findpassword}">
        <div>
            <label for="email">이메일 주소:</label>
            <input type="email" id="email" name="email" placeholder="이메일 주소" required>
        </div>
        <p id="check_result"></p>
        <!-- JavaScript로 결과를 트리거하기 위해 button 타입 변경 -->
        <button type="button" onclick="emailCheck()">이메일 찾기</button>
     <!-- 비밀번호를 표시할 영역 -->
    <div id="password_display"></div>
    </form>

   
  

<script th:inline="javascript">
/*<![CDATA[*/
	
    const emailCheck = () => {
        const email = document.getElementById("email").value;
        const checkResult = document.getElementById("check_result");

        $.ajax({
            type: "post",
            url: "/member/email-check",
            data: { "memberEmail": email },
            success: function (res) {
                console.log("요청 성공", res); 
                if (res === "ok") {
                    checkResult.style.color = "red";
                    checkResult.innerHTML = "존재하지 않는 이메일입니다.";
                } else {
                    checkResult.style.color = "green";
                    checkResult.innerHTML = "존재하는 이메일입니다.";
                    displayPassword(email);// 이메일이 존재하는 경우 비밀번호를 보여줌.
                }
            },
            error: function (err) {
                console.log("에러발생", err);
            }
        });
    }

    // 비밀번호를 가져와서 화면에 표시하는 함수
    function displayPassword(email) {
        $.ajax({
            type: "post",
            url: "/member/get-password",
            data: { "memberEmail": email },
            success: function (password) {
                // 비밀번호가 존재하는 경우
                if (password) {
                    const passwordDisplay = document.getElementById("password_display");
                    passwordDisplay.innerHTML = "회원님의 비밀번호는 " + password + "입니다.";
                } else {
                    const passwordDisplay = document.getElementById("password_display");
                    passwordDisplay.innerHTML = "해당 이메일로 등록된 회원이 없거나 비밀번호를 찾을 수 없습니다.";
                }
            },
            error: function (err) {
                console.log("비밀번호 가져오기 실패", err);
                const passwordDisplay = document.getElementById("password_display");
                passwordDisplay.innerHTML = "비밀번호를 가져오는 중 오류가 발생했습니다.";
            }
        });
    }
/*]]>*/
</script>

</body>
</html>